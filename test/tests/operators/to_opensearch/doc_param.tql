---
runner: multi
fixtures: [http]
timeout: 60
---

from {
  x: 1,
  ip: 10.10.10.10,
}, {
  id: "1.1.1.1",
  doc: {},
}, {
  id: "Something",
  doc: {x: 10.10.10.10},
}
set target_doc = doc? else this
where id? == null
to_opensearch env("HTTP_FIXTURE_ENDPOINT"), tls=false, action="upsert", index="main", doc=target_doc, compress=false

from {
  x: 1,
  ip: 10.10.10.10,
}, {
  id: "1.1.1.1",
  doc: {},
}, {
  id: "Something",
  doc: {x: 10.10.10.10},
}
set target_doc = doc? else this
set target_id = id?
where target_id != null
to_opensearch env("HTTP_FIXTURE_ENDPOINT"), tls=false, action="upsert", index="main", id=target_id, doc=target_doc, compress=false

load_file env("HTTP_CAPTURE_FILE")
